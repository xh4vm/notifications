# Проектная работа 10 спринта

[Ссылка на работу](https://github.com/xh4vm/notifications)

## Запуск проекта
``` 
cp .env.example .env
mkdir ./backend/admin_panel/static && touch ./backend/admin_panel/static/info.log && touch ./backend/admin_panel/static/error.log
mkdir ./backend/notice_api/static && touch ./backend/notice_api/static/info.log && touch ./backend/notice_api/static/error.log
rm -rf ./nginx/static && cp -r ./nginx/static_defaults/ ./nginx/static
make notice
```
## Описание проекта
Алгоритм работы сервиса:
1. Генерация события. Может быть: `автоматизированное периодическое`, `автоматизированное моментальное`, `ручное`
2. Отправка события в `notice_api`. Сохранение задачи в очередь на билдинг с параметрами в кластер `rabbitmq`
3. Получение задачи с параметрами сервисом `builder`
4. Получение шаблона по идентификатору события
5. Получение контекста для формирования сообщения (будет осуществляться через апи сторонних сервисов. На данный момент замокано)
6. Получение пользователей для актуальной рассылки (будет осуществляться через апи сторонних сервисов. На данный момент замокано)
7. Формирование сообщения
8. Сохранение сообщения в очередь на отправку
9. Получение сообщения сервисом `sender`
10. Отправка сообщения с использованием своего `smtp` сервера

## Документация
### Notice API
http://localhost:8080/api/openapi
### Админка
http://localhost:8001/admin

### Миграции админки
`backend/admin_panel/notice/migrations`

## Описание сценариев Makefile
- `make notice` - установить виртуальное окружение; установить необходимые зависимости для запуска контейнеров; пересобрать контейнеры в интерактивном режиме для сервиса нотификации
- `make pre-commit` - установить виртуальное окружение; установить необходимые для запуска прекоммитов зависимости; добавить статические файлы; запустить выполнение инструкций прекоммита
- `make clean-pyc` - удалить все pyc-файлы из проекта
- `make clean-all` - остановить и удалить все контейнеры и занимаемую ими память и удалить все pyc-файлы из проекта
- `make clean` - остановить и удалить контейнеры соответствующие данному проекту и занимаемую ими память и удалить все pyc-файлы из проекта
